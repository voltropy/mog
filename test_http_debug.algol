// Debug HTTP client - simpler version

fn main() -> i64 {
  print_string("=== Debug HTTP Client ===");
  println();
  
  // Create socket
  sockfd: i64 = sys_socket(2, 1, 0);
  print_string("Socket fd: ");
  print(sockfd);
  println();
  
  // Connect
  ip_addr: i64 = sys_inet_addr("54.204.147.107");
  print_string("Connecting...");
  println();
  
  conn: i64 = sys_connect(sockfd, ip_addr, 80);
  print_string("Connect: ");
  print(conn);
  println();
  
  if (conn < 0) {
    print_string("Connect failed");
    println();
    sys_close(sockfd);
    return 1;
  }
  
  // Send
  request: ptr = "GET /get HTTP/1.1\r\nHost: httpbin.org\r\nConnection: close\r\n\r\n";
  sent: i64 = sys_send(sockfd, request, 63);
  print_string("Sent: ");
  print(sent);
  println();
  
  // Single recv
  buf: ptr = gc_alloc(8192);
  print_string("About to recv...");
  println();
  
  bytes: i64 = sys_recv(sockfd, buf, 8192);
  print_string("Received: ");
  print(bytes);
  println();
  
  if (bytes > 0) {
    buf[bytes] := 0;
    print_string(buf);
    println();
  }
  
  sys_close(sockfd);
  print_string("Done!");
  println();
  return 0;
}
