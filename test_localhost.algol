// Test socket connection to localhost

fn main() -> i64 {
  print_string("=== Socket Test to localhost ===");
  println();
  
  // Create socket
  sockfd: i64 = sys_socket(2, 1, 0);
  print_string("Socket created, fd: ");
  print(sockfd);
  println();
  
  if (sockfd < 0) {
    print_string("Failed to create socket");
    println();
    return 1;
  }
  
  // Test with localhost (127.0.0.1 = 0x7f000001 in host order)
  localhost_ip: i64 = 2130706433;  // 127.0.0.1 in decimal = 0x7f000001
  print_string("Connecting to localhost (127.0.0.1)...");
  println();
  
  result: i64 = sys_connect(sockfd, localhost_ip, 8080);
  print_string("Connect result: ");
  print(result);
  println();
  
  if (result < 0) {
    print_string("Failed to connect (expected if nothing listening on 8080)");
    println();
    err: i64 = sys_errno();
    print_string("errno: ");
    print(err);
    println();
  } else {
    print_string("Connected successfully!");
    println();
  }
  
  sys_close(sockfd);
  return 0;
}
