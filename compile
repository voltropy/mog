#!/usr/bin/env bun
import { compile } from "./src/compiler.js"
import { readFileSync } from "fs"

const inputFile = process.argv[2]
if (!inputFile) {
  console.error("Usage: ./compile <file.mog>")
  process.exit(1)
}

const source = readFileSync(inputFile, "utf-8")
const { llvmIR, errors } = await compile(source)

if (errors.length > 0) {
  console.error("Compilation errors:")
  for (const error of errors) {
    console.error(`  Line ${error.line}, Col ${error.column}: ${error.message}`)
  }
  process.exit(1)
}

await Bun.write("build/temp.ll", llvmIR)
console.log(`Compiled ${inputFile} to build/temp.ll`)