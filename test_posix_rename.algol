fn main() -> i64 {
  fd: i64 = open("test_rename_source.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);

  if (fd == -1) {
    return 1;
  }

  write(fd, "test data for rename\n", 21);
  close(fd);

  result: i64 = rename("test_rename_source.txt", "test_rename_target.txt");

  if (result == -1) {
    unlink("test_rename_source.txt");
    return 2;
  }

  old_exists: i64 = access("test_rename_source.txt", 0);

  if (old_exists == 0) {
    unlink("test_rename_target.txt");
    return 3;
  }

  new_exists: i64 = access("test_rename_target.txt", 0);

  if (new_exists != 0) {
    unlink("test_rename_target.txt");
    return 4;
  }

  unlink("test_rename_target.txt");

  return 0;
}