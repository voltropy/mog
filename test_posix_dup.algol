# Test POSIX dup and dup2 system calls
fn main() -> i64 {
  fd: i64 = open("test_dup.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);

  if (fd == -1) {
    return 1;
  }

  write(fd, "Original data\n", 14);

  fd_dup: i64 = dup(fd);

  if (fd_dup == -1) {
    close(fd);
    unlink("test_dup.txt");
    return 2;
  }

  write(fd_dup, "Written via dup\n", 16);

  fd_dup2: i64 = dup2(fd, 10);

  if (fd_dup2 == -1) {
    close(fd);
    close(fd_dup);
    unlink("test_dup.txt");
    return 3;
  }

  write(10, "Written via dup2\n", 16);

  close(fd);
  close(fd_dup);
  close(10);
  unlink("test_dup.txt");

  return 0;
}