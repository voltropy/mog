# Test POSIX access and faccessat functions
fn main() -> i64 {
  fd: i64 = open("test_access_file.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);
  if (fd == -1) {
    return 1;
  }
  write(fd, "Test content for access check\n", 29);
  close(fd);

  result: i64 = access("test_access_file.txt", 0);
  if (result != 0) {
    unlink("test_access_file.txt");
    return 2;
  }

  result = access("test_access_file_nonexistent.txt", 0);
  if (result == 0) {
    unlink("test_access_file.txt");
    return 3;
  }

  result = access("test_access_file.txt", 4);
  if (result != 0) {
    unlink("test_access_file.txt");
    return 4;
  }

  result = access("test_access_file.txt", 2);
  if (result != 0) {
    unlink("test_access_file.txt");
    return 5;
  }

  result = access("test_access_file.txt", 4 | 2);
  if (result != 0) {
    unlink("test_access_file.txt");
    return 6;
  }

  result = faccessat(-100, "test_access_file.txt", 4, 0);
  if (result != 0) {
    unlink("test_access_file.txt");
    return 7;
  }

  result = faccessat(-100, "nonexistent_for_faccessat.txt", 0, 0);
  if (result == 0) {
    unlink("test_access_file.txt");
    return 8;
  }

  unlink("test_access_file.txt");

  return 0;
}
