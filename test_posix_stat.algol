fn main() -> i64 {
  fd: i64 = open("test_stat_file.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);

  if (fd == -1) {
    return 1;
  }

  write(fd, "Test content for stat\n", 22);
  close(fd);

  statbuf: i64[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  statbuf_ptr: i64 = cast<i64>(statbuf);
  stat_result: i64 = stat("test_stat_file.txt", statbuf_ptr);

  if (stat_result == -1) {
    unlink("test_stat_file.txt");
    return 2;
  }

  symlink_result: i64 = symlink("test_stat_file.txt", "test_stat_symlink.txt");

  if (symlink_result == -1) {
    unlink("test_stat_file.txt");
    return 3;
  }

  lstatbuf: i64[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  lstatbuf_ptr: i64 = cast<i64>(lstatbuf);
  lstat_result: i64 = lstat("test_stat_symlink.txt", lstatbuf_ptr);

  if (lstat_result == -1) {
    unlink("test_stat_file.txt");
    unlink("test_stat_symlink.txt");
    return 4;
  }

  fd = open("test_stat_file.txt", O_RDONLY, 0);

  if (fd == -1) {
    unlink("test_stat_file.txt");
    unlink("test_stat_symlink.txt");
    return 5;
  }

  fstatbuf: i64[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  fstatbuf_ptr: i64 = cast<i64>(fstatbuf);
  fstat_result: i64 = fstat(fd, fstatbuf_ptr);

  if (fstat_result == -1) {
    close(fd);
    unlink("test_stat_file.txt");
    unlink("test_stat_symlink.txt");
    return 6;
  }

  close(fd);
  unlink("test_stat_file.txt");
  unlink("test_stat_symlink.txt");

  return 0;
}