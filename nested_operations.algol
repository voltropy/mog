# Complex AlgolScript Test Program
# Tests multiple language features together

{
  # Test 1: Nested loops with arithmetic
  sum: i64 = 0;
  i: i64 = 0;
  while (i < 10) {
    j: i64 = 0;
    while (j < 10) {
      sum := sum + i * j;
      j := j + 1;
    }
    i := i + 1;
  }

  # Test 2: Nested functions
  fn square(x: i64) -> i64 {
    return x * x;
  }

  fn cube(x: i64) -> i64 {
    return x * square(x);
  }

  # Test 3: Conditional with function calls
  result: i64 = square(5);
  if (result > 20) {
    result := cube(3);
  }

  # Test 4: Modulo operations
  a: i64 = 17;
  b: i64 = 5;
  mod_result: i64 = a % b;

  # Test 5: Complex arithmetic expressions
  x: i64 = 10;
  y: i64 = 20;
  z: i64 = (x + y) * 2 - (x - y) / 2;

  # Test 6: Nested if statements
  nested_test: i64 = 0;
  if (x > 5) {
    if (y > 15) {
      nested_test := 1;
    }
  }

  # Test 7: Function with multiple parameters
  fn combine(a: i64, b: i64, c: i64, d: i64) -> i64 {
    return a + b * c - d;
  }

  final_result: i64 = combine(1, 2, 3, 4);

  # Test 8: Recursion depth test
  fn fibonacci(n: i64) -> i64 {
    if (n = 0) {
      return 0;
    }
    if (n = 1) {
      return 1;
    }
    return fibonacci(n - 1) + fibonacci(n - 2);
  }

  fib_10: i64 = fibonacci(10);

  # All tests completed - program should exit cleanly
}