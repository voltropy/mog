# Comprehensive POSIX filesystem test
fn main() -> i64 {
  fd: i64 = open("comprehensive_test.txt", O_CREAT | O_WRONLY | O_TRUNC, 0644);

  if (fd == -1) {
    return 1;
  }

  write(fd, "Line 1: Testing write\n", 21);
  write(fd, "Line 2: Another line\n", 21);
  close(fd);

  fd = open("comprehensive_test.txt", O_RDONLY, 0);

  if (fd == -1) {
    return 2;
  }

  buffer: i64[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  bytes: i64 = read(fd, buffer, 512);

  if (bytes == -1) {
    close(fd);
    return 3;
  }

  close(fd);

  dir_result: i64 = mkdir("test_dir_posix", 0755);

  if (dir_result == -1) {
    return 4;
  }

  rmdir("test_dir_posix");

  unlink("comprehensive_test.txt");

  return 0;
}